/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function i(){}function o(){o.init.call(this)}function s(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,n){if(e)t.call(n);else for(var r=t.length,i=v(t,r),o=0;o<r;++o)i[o].call(n)}function a(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=v(t,i),s=0;s<i;++s)o[s].call(n,r)}function c(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=v(t,o),u=0;u<o;++u)s[u].call(n,r,i)}function h(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,u=v(t,s),a=0;a<s;++a)u[a].call(n,r,i,o)}function f(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=v(t,i),s=0;s<i;++s)o[s].apply(n,r)}function d(t,e,n,r){var o,u,a,c;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((u=t._events)?(u.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),u=t._events),a=u[e]):(u=t._events=new i,t._eventsCount=0),a){if("function"==typeof a?a=u[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(o=s(t))&&o>0&&a.length>o){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,c=h,"function"==typeof console.warn?console.warn(c):console.log(c)}}else a=u[e]=n,++t._eventsCount;return t}function l(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function p(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function v(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}i.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new i,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return s(this)},o.prototype.emit=function(t){var e,n,r,i,o,s,d,l="error"===t;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(d=this.domain,l){if(e=arguments[1],!d){if(e instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=d,e.domainThrown=!1,d.emit("error",e),!1}if(!(n=s[t]))return!1;var v="function"==typeof n;switch(r=arguments.length){case 1:u(n,v,this);break;case 2:a(n,v,this,arguments[1]);break;case 3:c(n,v,this,arguments[1],arguments[2]);break;case 4:h(n,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];f(n,v,this,i)}return!0},o.prototype.addListener=function(t,e){return d(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return d(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,l(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,l(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,r,o,s,u;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new i:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,s=n.length;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){u=n[s].listener,o=s;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new i,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,o);r.removeListener&&this.emit("removeListener",t,u||e)}return this},o.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new i,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new i:delete n[t]),this;if(0===arguments.length){for(var r,o=Object.keys(n),s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new i,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},o.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var w,m=1e7,y=function(t){function i(e,n,r){void 0===n&&(n=0),void 0===r&&(r=1e7);var i=t.call(this)||this;i.transport=e,i.mode=n,i.clockFrequency=r,i.connected=!1,i.blockSize=i.transport.packetSize-4-1;var o=i.transport.packetSize-2-1;return i.operationCount=Math.floor(o/5),i}return e(i,t),i.prototype.bufferSourceToUint8Array=function(t,e){if(!e)return new Uint8Array([t]);var n=void 0!==e.buffer?e.buffer:e,r=new Uint8Array(n.byteLength+1);return r.set([t]),r.set(new Uint8Array(n),1),r},i.prototype.selectProtocol=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=2===t?59196:59294,[4,this.swjSequence(new Uint8Array([255,255,255,255,255,255,255]))];case 1:return n.sent(),[4,this.swjSequence(new Uint16Array([e]))];case 2:return n.sent(),[4,this.swjSequence(new Uint8Array([255,255,255,255,255,255,255]))];case 3:return n.sent(),[4,this.swjSequence(new Uint8Array([0]))];case 4:return n.sent(),[2]}}))}))},i.prototype.send=function(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return n=this.bufferSourceToUint8Array(t,e),[4,this.transport.write(n)];case 1:return r.sent(),[4,this.transport.read()];case 2:if((i=r.sent()).getUint8(0)!==t)throw new Error("Bad response for "+t+" -> "+i.getUint8(0));switch(t){case 3:case 8:case 9:case 10:case 17:case 18:case 19:case 29:case 23:case 24:case 26:case 21:case 22:case 4:if(0!==i.getUint8(1))throw new Error("Bad status for "+t+" -> "+i.getUint8(1))}return[2,i]}}))}))},i.prototype.dapInfo=function(t){return n(this,void 0,void 0,(function(){var e,n,i;return r(this,(function(r){switch(r.label){case 0:return[4,this.send(0,new Uint8Array([t]))];case 1:if(e=r.sent(),0===(n=e.getUint8(1)))throw new Error("DAP Info Failure");switch(t){case 240:case 254:case 255:case 253:if(1===n)return[2,e.getUint8(2)];if(2===n)return[2,e.getUint16(2)];if(4===n)return[2,e.getUint32(2)]}return i=Array.prototype.slice.call(new Uint8Array(e.buffer,2,n)),[2,String.fromCharCode.apply(null,i)]}}))}))},i.prototype.swjSequence=function(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return e=8*t.byteLength,n=this.bufferSourceToUint8Array(e,t),[4,this.send(18,n)];case 1:return r.sent(),[2]}}))}))},i.prototype.configureTransfer=function(t,e,i){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return n=new Uint8Array(5),(o=new DataView(n.buffer)).setUint8(0,t),o.setUint16(1,e,!0),o.setUint16(3,i,!0),[4,this.send(4,n)];case 1:return r.sent(),[2]}}))}))},i.prototype.connect=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return!0===this.connected?[2,Promise.resolve()]:[4,this.transport.open()];case 1:return e.sent(),[4,this.send(17,new Uint32Array([this.clockFrequency]))];case 2:return e.sent(),[4,this.send(2,new Uint8Array([this.mode]))];case 3:if(0===(t=e.sent()).getUint8(1)||0!==this.mode&&t.getUint8(1)!==this.mode)throw new Error("Mode not enabled.");return[4,this.configureTransfer(0,100,0)];case 4:return e.sent(),[4,this.selectProtocol(1)];case 5:return e.sent(),this.connected=!0,[2]}}))}))},i.prototype.disconnect=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return!1===this.connected?[2,Promise.resolve()]:[4,this.send(3)];case 1:return t.sent(),[4,this.transport.close()];case 2:return t.sent(),this.connected=!1,[2]}}))}))},i.prototype.reconnect=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.disconnect()];case 1:return t.sent(),[4,new Promise((function(t){return setTimeout(t,100)}))];case 2:return t.sent(),[4,this.connect()];case 3:return t.sent(),[2]}}))}))},i.prototype.reset=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.send(10)];case 1:return[2,1===t.sent().getUint8(2)]}}))}))},i.prototype.transfer=function(t,e,i,o){return void 0===e&&(e=2),void 0===i&&(i=0),void 0===o&&(o=0),n(this,void 0,void 0,(function(){var n,s,u,a,c,h;return r(this,(function(r){switch(r.label){case 0:return n="number"==typeof t?[{port:t,mode:e,register:i,value:o}]:t,s=new Uint8Array(2+5*n.length),(u=new DataView(s.buffer)).setUint8(0,0),u.setUint8(1,n.length),n.forEach((function(t,e){var n=2+5*e;u.setUint8(n,t.port|t.mode|t.register),u.setUint32(n+1,t.value||0,!0)})),[4,this.send(5,s)];case 1:if((a=r.sent()).getUint8(1)!==n.length)throw new Error("Transfer count mismatch");if(2===(c=a.getUint8(2)))throw new Error("Transfer response WAIT");if(4===c)throw new Error("Transfer response FAULT");if(8===c)throw new Error("Transfer response PROTOCOL_ERROR");if(16===c)throw new Error("Transfer response VALUE_MISMATCH");if(7===c)throw new Error("Transfer response NO_ACK");return"number"==typeof t?[2,a.getUint32(3,!0)]:(h=4*n.length,[2,new Uint32Array(a.buffer.slice(3,3+h))])}}))}))},i.prototype.transferBlock=function(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,u,a,c,h;return r(this,(function(r){switch(r.label){case 0:return s=4,"number"==typeof i?(n=i,o=2):(n=i.length,o=0,s+=i.byteLength),u=new Uint8Array(s),(a=new DataView(u.buffer)).setUint8(0,0),a.setUint16(1,n,!0),a.setUint8(3,t|o|e),"number"!=typeof i&&i.forEach((function(t,e){var n=4+4*e;a.setUint32(n,t,!0)})),[4,this.send(6,a)];case 1:if((c=r.sent()).getUint16(1,!0)!==n)throw new Error("Transfer count mismatch");if(2===(h=c.getUint8(3)))throw new Error("Transfer response WAIT");if(4===h)throw new Error("Transfer response FAULT");if(8===h)throw new Error("Transfer response PROTOCOL_ERROR");if(7===h)throw new Error("Transfer response NO_ACK");return"number"==typeof i?[2,new Uint32Array(c.buffer.slice(4,4+4*n))]:[2,void 0]}}))}))},i}(o),b=/[\xc0-\xff][\x80-\xbf]*$/g,g=/[\xc0-\xff][\x80-\xbf]*/g,C=function(){function t(){}return t.prototype.decode=function(t){var e=Array.prototype.slice.call(new Uint8Array(t)),n=String.fromCodePoint.apply(void 0,e);this.partialChar&&(n=""+this.partialChar+n,this.partialChar=void 0);var r=n.match(b);if(r){var i=r[0].length;this.partialChar=n.slice(-i),n=n.slice(0,-i)}return n.replace(g,this.decoderReplacer)},t.prototype.decoderReplacer=function(t){var e=t.codePointAt(0)<<24,n=Math.clz32(~e),r=0,i=t.length,o="";if(n<5&&i>=n){for(e=e<<n>>>24+n,r=1;r<n;r+=1)e=e<<6|63&t.codePointAt(r);e<=65535?o+=String.fromCodePoint(e):e<=1114111?(e-=65536,o+=String.fromCodePoint(55296+(e>>10),56320+(1023&e))):r=0}for(;r<i;r+=1)o+="ï¿½";return o},t}(),A=new C,E=function(t){function i(e,o,s){void 0===o&&(o=0),void 0===s&&(s=1e7);var u=t.call(this,e,o,s)||this;return u.serialPolling=!1,u.serialListeners=!1,u.on("newListener",(function(t){return n(u,void 0,void 0,(function(){return r(this,(function(e){return t===i.EVENT_SERIAL_DATA&&0===this.listenerCount(t)&&(this.serialListeners=!0),[2]}))}))})),u.on("removeListener",(function(t){t===i.EVENT_SERIAL_DATA&&(0===u.listenerCount(t)&&(u.serialListeners=!1))})),u}return e(i,t),i.prototype.isBufferBinary=function(t){for(var e=Array.prototype.slice.call(new Uint16Array(t,0,50)),n=String.fromCharCode.apply(null,e),r=0;r<n.length;r++){var i=n.charCodeAt(r);if(65533===i||i<=8)return!0}return!1},i.prototype.writeBuffer=function(t,e,o){return void 0===o&&(o=0),n(this,void 0,void 0,(function(){var n,s,u;return r(this,(function(r){switch(r.label){case 0:return n=Math.min(t.byteLength,o+e),s=t.slice(o,n),(u=new Uint8Array(s.byteLength+1)).set([s.byteLength]),u.set(new Uint8Array(s),1),[4,this.send(140,u)];case 1:return r.sent(),this.emit(i.EVENT_PROGRESS,o/t.byteLength),n<t.byteLength?[2,this.writeBuffer(t,e,n)]:[2]}}))}))},i.prototype.flash=function(t,e){return void 0===e&&(e=62),n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return n=function(t){return void 0!==t.buffer}(t)?t.buffer:t,o=this.isBufferBinary(n)?0:1,[4,this.send(138,new Uint32Array([o]))];case 1:if(0!==r.sent().getUint8(1))throw new Error("Flash error");return[4,this.writeBuffer(n,e)];case 2:return r.sent(),this.emit(i.EVENT_PROGRESS,1),[4,this.send(139)];case 3:if(0!==r.sent().getUint8(1))throw new Error("Flash error");return[4,this.send(137)];case 4:return r.sent(),[2]}}))}))},i.prototype.getSerialBaudrate=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.send(129)];case 1:return[2,t.sent().getUint32(1,!0)]}}))}))},i.prototype.setSerialBaudrate=function(t){return void 0===t&&(t=9600),n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.send(130,new Uint32Array([t]))];case 1:return e.sent(),[2]}}))}))},i.prototype.serialWrite=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=t.split("").map((function(t){return t.charCodeAt(0)}))).unshift(e.length),[4,this.send(132,new Uint8Array(e).buffer)];case 1:return n.sent(),[2]}}))}))},i.prototype.serialRead=function(){return n(this,void 0,void 0,(function(){var t,e;return r(this,(function(n){switch(n.label){case 0:return[4,this.send(131)];case 1:return 0===(t=n.sent()).byteLength||(131!==t.getUint8(0)||0===(e=t.getUint8(1)))?[2,void 0]:(2,[2,t.buffer.slice(2,2+e)])}}))}))},i.prototype.startSerialRead=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=!0),n(this,void 0,void 0,(function(){var n,o,s;return r(this,(function(r){switch(r.label){case 0:this.serialPolling=!0,r.label=1;case 1:return this.serialPolling?this.serialListeners?(n=this.connected,!1!==this.connected||!0!==e?[3,3]:[4,this.connect()]):[3,7]:[3,9];case 2:r.sent(),r.label=3;case 3:return[4,this.serialRead()];case 4:return o=r.sent(),!1!==n||!0!==e?[3,6]:[4,this.disconnect()];case 5:r.sent(),r.label=6;case 6:void 0!==o&&(s=A.decode(o),this.emit(i.EVENT_SERIAL_DATA,s)),r.label=7;case 7:return[4,new Promise((function(e){return setTimeout(e,t)}))];case 8:return r.sent(),[3,1];case 9:return[2]}}))}))},i.prototype.stopSerialRead=function(){this.serialPolling=!1},i.EVENT_PROGRESS="progress",i.EVENT_SERIAL_DATA="serial",i}(y),U=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=1e7);this.proxy=void 0!==t.open?new y(t,e,n):t}return t.prototype.waitDelay=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=100),n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:n=!0,e>0&&setTimeout((function(){if(n)throw n=!1,new Error("Wait timed out")}),e),r.label=1;case 1:return n?[4,t()]:[3,5];case 2:return!0===r.sent()?(n=!1,[2]):i>0?[4,new Promise((function(t){return setTimeout(t,e)}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[3,1];case 5:return[2]}}))}))},t.prototype.concatTypedArray=function(t){if(1===t.length)return t[0];for(var e=0,n=0,r=t;n<r.length;n++){e+=r[n].length}for(var i=new Uint32Array(e),o=0,s=0;o<t.length;o++)i.set(t[o],s),s+=t[o].length;return i},t.prototype.readDPCommand=function(t){return[{mode:2,port:0,register:t}]},t.prototype.writeDPCommand=function(t,e){if(8===t){if(e===this.selectedAddress)return[];this.selectedAddress=e}return[{mode:0,port:0,register:t,value:e}]},t.prototype.readAPCommand=function(t){var e=4278190080&t|240&t;return this.writeDPCommand(8,e).concat({mode:2,port:1,register:t})},t.prototype.writeAPCommand=function(t,e){if(0===t){if(e===this.cswValue)return[];this.cswValue=e}var n=4278190080&t|240&t;return this.writeDPCommand(8,n).concat({mode:0,port:1,register:t,value:e})},t.prototype.readMem16Command=function(t){return this.writeAPCommand(0,587202641).concat(this.writeAPCommand(4,t)).concat(this.readAPCommand(12))},t.prototype.writeMem16Command=function(t,e){return this.writeAPCommand(0,587202641).concat(this.writeAPCommand(4,t)).concat(this.writeAPCommand(12,e))},t.prototype.readMem32Command=function(t){return this.writeAPCommand(0,587202642).concat(this.writeAPCommand(4,t)).concat(this.readAPCommand(12))},t.prototype.writeMem32Command=function(t,e){return this.writeAPCommand(0,587202642).concat(this.writeAPCommand(4,t)).concat(this.writeAPCommand(12,e))},t.prototype.transferSequence=function(t){return n(this,void 0,void 0,(function(){var e,n,i,o;return r(this,(function(r){switch(r.label){case 0:e=(e=[]).concat.apply(e,t),n=[],r.label=1;case 1:return e.length?(i=e.splice(0,this.proxy.operationCount),[4,this.proxy.transfer(i)]):[3,3];case 2:return o=r.sent(),n.push(o),[3,1];case 3:return[2,this.concatTypedArray(n)]}}))}))},t.prototype.connect=function(){return n(this,void 0,void 0,(function(){var t,e=this;return r(this,(function(i){switch(i.label){case 0:return t=-1610612736,[4,this.proxy.connect()];case 1:return i.sent(),[4,this.readDP(0)];case 2:return i.sent(),[4,this.transferSequence([this.writeDPCommand(0,4),this.writeDPCommand(8,0),this.writeDPCommand(4,1342177280)])];case 3:return i.sent(),[4,this.waitDelay((function(){return n(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.readDP(4)];case 1:return[2,(e.sent()&t)===t]}}))}))}))];case 4:return i.sent(),[2]}}))}))},t.prototype.disconnect=function(){return this.proxy.disconnect()},t.prototype.reconnect=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.disconnect()];case 1:return t.sent(),[4,new Promise((function(t){return setTimeout(t,100)}))];case 2:return t.sent(),[4,this.connect()];case 3:return t.sent(),[2]}}))}))},t.prototype.reset=function(){return this.proxy.reset()},t.prototype.readDP=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.proxy.transfer(this.readDPCommand(t))];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.writeDP=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.proxy.transfer(this.writeDPCommand(t,e))];case 1:return n.sent(),[2]}}))}))},t.prototype.readAP=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.proxy.transfer(this.readAPCommand(t))];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.writeAP=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.proxy.transfer(this.writeAPCommand(t,e))];case 1:return n.sent(),[2]}}))}))},t.prototype.readMem16=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.proxy.transfer(this.readMem16Command(t))];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.writeMem16=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return e<<=(2&t)<<3,[4,this.proxy.transfer(this.writeMem16Command(t,e))];case 1:return n.sent(),[2]}}))}))},t.prototype.readMem32=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.proxy.transfer(this.readMem32Command(t))];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.writeMem32=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.proxy.transfer(this.writeMem32Command(t,e))];case 1:return n.sent(),[2]}}))}))},t.prototype.readBlock=function(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s;return r(this,(function(r){switch(r.label){case 0:return[4,this.transferSequence([this.writeAPCommand(0,587202642),this.writeAPCommand(4,t)])];case 1:r.sent(),n=[],i=e,r.label=2;case 2:return i>0?(o=Math.min(i,Math.floor(this.proxy.blockSize/4)),[4,this.proxy.transferBlock(1,12,o)]):[3,4];case 3:return s=r.sent(),n.push(s),i-=o,[3,2];case 4:return[2,this.concatTypedArray(n)]}}))}))},t.prototype.writeBlock=function(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return[4,this.transferSequence([this.writeAPCommand(0,587202642),this.writeAPCommand(4,t)])];case 1:r.sent(),n=0,r.label=2;case 2:return n<e.length?(i=e.slice(n,n+Math.floor(this.proxy.blockSize/4)),[4,this.proxy.transferBlock(1,12,i)]):[3,4];case 3:return r.sent(),n+=Math.floor(this.proxy.blockSize/4),[3,2];case 4:return[2]}}))}))},t}(),P=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.enableDebug=function(){return this.writeMem32(3758157296,-1604386815)},i.prototype.readCoreRegisterCommand=function(t){return this.writeMem32Command(3758157300,t).concat(this.readMem32Command(3758157296)).concat(this.readMem32Command(3758157304))},i.prototype.writeCoreRegisterCommand=function(t,e){return this.writeMem32Command(3758157304,e).concat(this.writeMem32Command(3758157300,65536|t))},i.prototype.getState=function(){return n(this,void 0,void 0,(function(){var t,e,n;return r(this,(function(r){switch(r.label){case 0:return[4,this.readMem32(3758157296)];case 1:return t=r.sent(),e=524288&t?1:262144&t?2:131072&t?3:4,33554432&t?[4,this.readMem32(3758157296)]:[3,3];case 2:return 33554432&(n=r.sent())&&!(16777216&n)?[2,0]:[2,e];case 3:return[2,e];case 4:return[2]}}))}))},i.prototype.isHalted=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.readMem32(3758157296)];case 1:return[2,!!(131072&t.sent())]}}))}))},i.prototype.halt=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=0),n(this,void 0,void 0,(function(){var n=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.isHalted()];case 1:return r.sent()?[2]:[4,this.writeMem32(3758157296,-1604386813)];case 2:return r.sent(),t?[2,this.waitDelay((function(){return n.isHalted()}),e)]:[2]}}))}))},i.prototype.resume=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=0),n(this,void 0,void 0,(function(){var i=this;return r(this,(function(o){switch(o.label){case 0:return[4,this.isHalted()];case 1:return o.sent()?[4,this.writeMem32(3758157104,7)]:[2];case 2:return o.sent(),[4,this.enableDebug()];case 3:return o.sent(),t?[2,this.waitDelay((function(){return n(i,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.isHalted()];case 1:return[2,!t.sent()]}}))}))}),e)]:[2]}}))}))},i.prototype.readCoreRegister=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,this.transferSequence([this.writeMem32Command(3758157300,t),this.readMem32Command(3758157296)])];case 1:if(e=n.sent(),!(65536&e[0]))throw new Error("Register not ready");return[2,this.readMem32(3758157304)]}}))}))},i.prototype.readCoreRegisters=function(t){return n(this,void 0,void 0,(function(){var e,n,i,o,s;return r(this,(function(r){switch(r.label){case 0:e=[],n=0,i=t,r.label=1;case 1:return n<i.length?(o=i[n],[4,this.readCoreRegister(o)]):[3,4];case 2:s=r.sent(),e.push(s),r.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},i.prototype.writeCoreRegister=function(t,e){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,this.transferSequence([this.writeMem32Command(3758157304,e),this.writeMem32Command(3758157300,65536|t),this.readMem32Command(3758157296)])];case 1:if(n=r.sent(),!(65536&n[0]))throw new Error("Register not ready");return[2]}}))}))},i.prototype.execute=function(t,e,i,o,s){void 0===s&&(s=t+1);for(var u=[],a=5;a<arguments.length;a++)u[a-5]=arguments[a];return n(this,void 0,void 0,(function(){var n,a,c,h=this;return r(this,(function(r){switch(r.label){case 0:for(48682!==e[e.length-1]&&((n=new Uint32Array(e.length+1)).set(e),n.set([48682],e.length-1),e=n),a=[this.writeCoreRegisterCommand(13,i),this.writeCoreRegisterCommand(15,o),this.writeCoreRegisterCommand(14,s)],c=0;c<Math.min(u.length,12);c++)a.push(this.writeCoreRegisterCommand(c,u[c]));return a.push(this.writeCoreRegisterCommand(16,16777216)),[4,this.halt()];case 1:return r.sent(),[4,this.transferSequence(a)];case 2:return r.sent(),[4,this.writeBlock(t,e)];case 3:return r.sent(),[4,this.resume(!1)];case 4:return r.sent(),[4,this.waitDelay((function(){return h.isHalted()}),1e4)];case 5:return r.sent(),[2]}}))}))},i.prototype.softReset=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.writeMem32(3758157308,0)];case 1:return t.sent(),[2,this.writeMem32(3758157068,100270084)]}}))}))},i.prototype.setTargetResetState=function(t){return void 0===t&&(t=!0),n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,this.writeMem32(3758157308,1)];case 1:return n.sent(),!0!==t?[3,3]:[4,this.reset()];case 2:return n.sent(),[3,6];case 3:return[4,this.readMem32(3758157068)];case 4:return e=n.sent(),[4,this.writeMem32(3758157068,100270084|e)];case 5:n.sent(),n.label=6;case 6:return[4,this.writeMem32(3758157308,0)];case 7:return n.sent(),[2]}}))}))},i}(U);!function(t){t[t.ENABLE=1]="ENABLE",t[t.KEY=2]="KEY"}(w||(w={}));var T=function(){function t(t){this.os="browser",this.packetSize=64;this.path=void 0!==t.path?t.path:t}return t.prototype.open=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){if(!this.path.length)throw new Error("No path specified");return t=require("node-hid"),this.device=new t.HID(this.path),[2]}))}))},t.prototype.close=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this.device&&this.device.close(),[2]}))}))},t.prototype.read=function(){return n(this,void 0,void 0,(function(){var t,e,n=this;return r(this,(function(r){switch(r.label){case 0:if(!this.device)throw new Error("No device opened");return[4,new Promise((function(t,e){n.device.read((function(n,r){if(n)return e(new Error(n));t(r)}))}))];case 1:return t=r.sent(),e=new Uint8Array(t).buffer,[2,new DataView(e)]}}))}))},t.prototype.write=function(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){if(!this.device)throw new Error("No device opened");for(e=function(t){return void 0!==t.buffer}(t)?t.buffer:t,n=Array.prototype.slice.call(new Uint8Array(e));n.length<this.packetSize;)n.push(0);if("win32"===this.os&&n.unshift(0),this.device.write(n)!==n.length)throw new Error("Incorrect bytecount written");return[2]}))}))},t}(),L=function(){function t(t,e,n,r){void 0===e&&(e=255),void 0===n&&(n=1),void 0===r&&(r=!1),this.device=t,this.interfaceClass=e,this.configuration=n,this.alwaysControlTransfer=r,this.packetSize=64}return t.prototype.bufferToDataView=function(t){var e=new Uint8Array(t).buffer;return new DataView(e)},t.prototype.isView=function(t){return void 0!==t.buffer},t.prototype.bufferSourceToBuffer=function(t){var e=this.isView(t)?t.buffer:t;return Buffer.from(e)},t.prototype.extendBuffer=function(t,e){var n=this.isView(t)?t.buffer:t,r=Math.min(n.byteLength,e),i=new Uint8Array(r);return i.set(new Uint8Array(n)),i},t.prototype.open=function(){return n(this,void 0,void 0,(function(){var t,e,n,i,o,s,u=this;return r(this,(function(r){switch(r.label){case 0:return this.device.open(),[4,new Promise((function(t,e){u.device.setConfiguration(u.configuration,(function(n){n?e(new Error(n)):t()}))}))];case 1:if(r.sent(),!(t=this.device.interfaces.filter((function(t){return t.descriptor.bInterfaceClass===u.interfaceClass}))).length)throw new Error("No valid interfaces found.");if((e=t.find((function(t){return t.endpoints.length>0})))||(e=t[0]),this.interfaceNumber=e.interfaceNumber,!this.alwaysControlTransfer){for(n=e.endpoints,this.endpointIn=void 0,this.endpointOut=void 0,i=0,o=n;i<o.length;i++)"in"===(s=o[i]).direction?this.endpointIn=s:this.endpointOut=s;if(this.endpointIn||this.endpointOut)try{e.claim()}catch(t){this.endpointIn=void 0,this.endpointOut=void 0}}return[2]}}))}))},t.prototype.close=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this.device.close(),[2]}))}))},t.prototype.read=function(){return n(this,void 0,void 0,(function(){var t,e=this;return r(this,(function(n){switch(n.label){case 0:if(void 0===this.interfaceNumber)throw new Error("No device opened");return[4,new Promise((function(t,n){e.endpointIn?e.endpointIn.transfer(e.packetSize,(function(e,r){e?n(e):t(r)})):e.device.controlTransfer(161,1,256,e.interfaceNumber,e.packetSize,(function(e,r){e?n(e):r?t(r):n(new Error("No buffer read"))}))}))];case 1:return t=n.sent(),[2,this.bufferToDataView(t)]}}))}))},t.prototype.write=function(t){return n(this,void 0,void 0,(function(){var e,n,i=this;return r(this,(function(r){switch(r.label){case 0:if(void 0===this.interfaceNumber)throw new Error("No device opened");return e=this.extendBuffer(t,this.packetSize),n=this.bufferSourceToBuffer(e),[4,new Promise((function(t,e){i.endpointOut?i.endpointOut.transfer(n,(function(n){if(n)return e(n);t()})):i.device.controlTransfer(33,9,512,i.interfaceNumber,n,(function(n){if(n)return e(n);t()}))}))];case 1:return r.sent(),[2]}}))}))},t}(),_=function(){function t(t,e,n,r){void 0===e&&(e=255),void 0===n&&(n=1),void 0===r&&(r=!1),this.device=t,this.interfaceClass=e,this.configuration=n,this.alwaysControlTransfer=r,this.packetSize=64}return t.prototype.extendBuffer=function(t,e){var n=void 0!==t.buffer?t.buffer:t,r=Math.min(n.byteLength,e),i=new Uint8Array(r);return i.set(new Uint8Array(n)),i},t.prototype.open=function(){return n(this,void 0,void 0,(function(){var t,e,n,i,o,s,u=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.device.open()];case 1:return r.sent(),[4,this.device.selectConfiguration(this.configuration)];case 2:if(r.sent(),!(t=this.device.configuration.interfaces.filter((function(t){return t.alternates[0].interfaceClass===u.interfaceClass}))).length)throw new Error("No valid interfaces found.");if((e=t.find((function(t){return t.alternates[0].endpoints.length>0})))||(e=t[0]),this.interfaceNumber=e.interfaceNumber,!this.alwaysControlTransfer)for(n=e.alternates[0].endpoints,this.endpointIn=void 0,this.endpointOut=void 0,i=0,o=n;i<o.length;i++)"in"===(s=o[i]).direction?this.endpointIn=s:this.endpointOut=s;return[2,this.device.claimInterface(this.interfaceNumber)]}}))}))},t.prototype.close=function(){return this.device.close()},t.prototype.read=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return void 0===this.interfaceNumber?[2,Promise.reject("No device opened")]:this.endpointIn?[4,this.device.transferIn(this.endpointIn.endpointNumber,this.packetSize)]:[3,2];case 1:return t=e.sent(),[3,4];case 2:return[4,this.device.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.interfaceNumber},this.packetSize)];case 3:t=e.sent(),e.label=4;case 4:return[2,t.data]}}))}))},t.prototype.write=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:if(void 0===this.interfaceNumber)throw new Error("No device opened");return e=this.extendBuffer(t,this.packetSize),this.endpointOut?[4,this.device.transferOut(this.endpointOut.endpointNumber,e)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this.device.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.interfaceNumber},e)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t}();export{U as ADI,y as CmsisDAP,P as CortexM,E as DAPLink,m as DEFAULT_CLOCK_FREQUENCY,w as FPBCtrlMask,T as HID,L as USB,_ as WebUSB};
//# sourceMappingURL=dap.esm.js.map
